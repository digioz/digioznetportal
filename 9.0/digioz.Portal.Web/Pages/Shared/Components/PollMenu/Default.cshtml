@model List<digioz.Portal.Bo.ViewModels.PollMenuItemViewModel>
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@if (Model == null || Model.Count == 0)
{
    <div class="card bg-light mb-3"><div class="card-body"><em>No polls available.</em></div></div>
    return;
}

@foreach (var item in Model)
{
    <div class="card bg-light mb-3">
        <div class="card-header d-flex justify-content-between align-items-center">
            <span>Poll</span>
            <small class="text-muted">@item.Poll.DateCreated.ToLocalTime().ToString("yyyy-MM-dd")</small>
        </div>
        <div class="card-body">
            <strong>@item.Poll.Slug</strong>
            <div class="mt-2">
                @if (item.HasVoted)
                {
                    <div class="alert alert-info p-1 mb-2">You have voted.</div>
                }
                else if (!item.Poll.IsClosed)
                {
                    @if (User.Identity?.IsAuthenticated ?? false)
                    {
                        <form method="post" asp-page="/Polls/Details" asp-page-handler="Vote" asp-route-id="@item.Poll.Id" asp-antiforgery="true">
                            @if (item.Poll.AllowMultipleOptionsVote)
                            {
                                foreach (var a in item.Answers)
                                {
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="SelectedAnswerIds" value="@a.Id" id="pm_@a.Id">
                                        <label class="form-check-label" for="pm_@a.Id">@a.Answer</label>
                                    </div>
                                }
                            }
                            else
                            {
                                foreach (var a in item.Answers)
                                {
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="SelectedAnswerIds" value="@a.Id" id="pm_@a.Id">
                                        <label class="form-check-label" for="pm_@a.Id">@a.Answer</label>
                                    </div>
                                }
                            }
                            <button type="submit" class="btn btn-sm btn-primary mt-2">Vote</button>
                            <a class="btn btn-sm btn-outline-secondary mt-2" asp-page="/Polls/Details" asp-route-id="@item.Poll.Id">Details</a>
                        </form>
                    }
                    else
                    {
                        <div class="alert alert-secondary p-1 mb-2">Sign in to vote.</div>
                        <a class="btn btn-sm btn-outline-secondary" asp-page="/Polls/Details" asp-route-id="@item.Poll.Id">Details</a>
                    }
                }
                else
                {
                    <div class="alert alert-warning p-1 mb-2">Poll closed.</div>
                }
            </div>
            @if (!string.IsNullOrEmpty(item.ResultsChartBase64))
            {
                <hr />
                <img class="img-fluid" src="data:image/png;base64,@item.ResultsChartBase64" alt="Poll Results" />
            }
        </div>
    </div>
}
