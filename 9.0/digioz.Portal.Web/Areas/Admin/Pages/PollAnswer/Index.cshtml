@page
@model digioz.Portal.Web.Areas.Admin.Pages.PollAnswer.IndexModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewBag.Title = "Poll Answers";
    Layout = "/Areas/Admin/Pages/Shared/_LayoutAdmin.cshtml";
}

<h1 class="mt-4">Poll Answers</h1>
<ol class="breadcrumb mb-4">
    <li class="breadcrumb-item">Admin</li>
    <li class="breadcrumb-item"><a asp-page="../Poll/Index">Poll</a></li>
    <li class="breadcrumb-item active">Answers</li>
</ol>

<div class="mb-3">
    <a class="btn btn-primary" asp-page="Add" asp-route-PollId="@Model.PollId">Add Answer</a>
    <a class="btn btn-secondary" asp-page="../Poll/Index">Back to Polls</a>
</div>

@if (!string.IsNullOrEmpty(Model.PollId) && Model.CurrentPoll is not null)
{
    <div class="card mb-3">
        <div class="card-header">Vote on: @Model.CurrentPoll.Slug</div>
        <div class="card-body">
            @if (Model.HasVoted)
            {
                <div class="alert alert-info">You have already voted for this poll.</div>
            }
            else
            {
                <form method="post" asp-page-handler="Vote">
                    <input type="hidden" name="PollId" value="@Model.PollId" />
                    <div class="mb-2">
                        @if (Model.CurrentPoll.AllowMultipleOptionsVote)
                        {
                            foreach (var a in Model.Items)
                            {
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="SelectedAnswerIds" value="@a.Id" id="a_@a.Id">
                                    <label class="form-check-label" for="a_@a.Id">@a.Answer</label>
                                </div>
                            }
                        }
                        else
                        {
                            foreach (var a in Model.Items)
                            {
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="SelectedAnswerIds" value="@a.Id" id="a_@a.Id">
                                    <label class="form-check-label" for="a_@a.Id">@a.Answer</label>
                                </div>
                            }
                        }
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Vote</button>
                </form>
            }
        </div>
    </div>
}

<table class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>Answer</th>
            <th>Poll</th>
            <th style="width:200px">Actions</th>
        </tr>
    </thead>
    <tbody>
    @foreach (var item in Model.Items)
    {
        <tr>
            <td>@item.Answer</td>
            <td>@(Model.PollSlugs.TryGetValue(item.PollId ?? string.Empty, out var slug) ? slug : item.PollId)</td>
            <td>
                <a class="btn btn-sm btn-warning" asp-page="Edit" asp-route-id="@item.Id">Edit</a>
                <a class="btn btn-sm btn-danger" asp-page="Delete" asp-route-id="@item.Id">Delete</a>
            </td>
        </tr>
    }
    </tbody>
</table>

<nav>
    <ul class="pagination">
        <li class="page-item @(Model.PageNumber <= 1 ? "disabled" : "")">
            <a class="page-link" asp-page="Index" asp-route-PollId="@Model.PollId" asp-route-PageNumber="@(Model.PageNumber - 1)" asp-route-PageSize="@Model.PageSize">Previous</a>
        </li>
        <li class="page-item disabled"><span class="page-link">Page @Model.PageNumber of @Model.TotalPages</span></li>
        <li class="page-item @(Model.PageNumber >= Model.TotalPages ? "disabled" : "")">
            <a class="page-link" asp-page="Index" asp-route-PollId="@Model.PollId" asp-route-PageNumber="@(Model.PageNumber + 1)" asp-route-PageSize="@Model.PageSize">Next</a>
        </li>
    </ul>
</nav>
